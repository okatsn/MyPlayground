
name: install-julia-print-hello
# on: [push]
on:
  push:
    branches: [ trygithubaction ]
jobs:
  install-julia:
    runs-on: ubuntu-20.04
    steps:
    - uses: julia-actions/setup-julia@v1
      with:
        version: 1.6.7
    - uses: actions/checkout@v3 # see https://github.com/actions/checkout
      id: checkout
      with:
        ref: 'trygithubaction'
    - name: Print message and execute a julia script
      run: | # `|` allows multi-line execution
          julia -e 'println("This is julia $(VERSION)")'
          julia -e 'println("Does it work on a branch besides master?"); println("Yes, it works!");'
          julia -e '
            println("Current directory of julia: $(pwd())");
            println("Files and folders under the current directory: ")
            println(readdir());
            println( [(root, dirs, files) for (root, dirs, files) in walkdir("./script")])
            '
          echo "Let's print some environment variables: "
          echo "GITHUB_WORKSPACE:" ${GITHUB_WORKSPACE}
          echo "GITHUB_ACTION_REPOSITORY:" ${GITHUB_ACTION_REPOSITORY}
          echo "GITHUB_PATH: " ${GITHUB_PATH}
          julia --project=. -e 'include("./script/github_actions/julia_script.jl")'
    - name: Save the result and commit # See https://github.com/orgs/community/discussions/26672
      id: hellocommit
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "github-actions"
        git add --all
        if [-z "$(git status --porcelain)"]; then
          echo "::set-output name=push::false"
        else
          git commit -m "Add changes" -a
          echo "::set-output name=push::true"
        fi
      shell: bash
    - name: Push changes
      if: steps.hellocommit.outputs.push == 'true'
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: steps.checkout.with.ref # this shis required and should be trygithubaction

# TOREAD:
# Documenter
# - https://discourse.julialang.org/t/easy-workflow-file-for-setting-up-github-actions-ci-for-your-julia-package/49765


# KEYNOTE:
# - Julia `--project` command: https://stackoverflow.com/questions/53613663/what-is-in-julia-project-command-line-option
